function [subj_info] = SIRatio_CSDS(subj_info_raw, threshold)
% % SIRatio_CSDS %
%PURPOSE:   Social interaction test results is added to the subj_info
%           structure
%AUTHORS:   AC Kwan 171005
%
%INPUT ARGUMENTS
%   subj_info_raw:    To get the subject names
%   threshold:        Threshold value for determining susceptible vs.
%                     resilient
%
%OUTPUT ARGUMENTS
%   subj_info:  The modified subj_info structure
%

%% Lookup table, from the social interaction experiments 
% subjectName, time for NoAggressor InteractionZone, A-IZ, NoA-Corners, A-Corners
SI_array={ ...
    '4_6',15,24,10,7; ...   %controls start here
    '4_7',14,45,9,4; ...
    '4_8',14,4,7,1; ...
    '4_9',26,25,17,19; ...
    '4_10',21,30,17,7; ...
    '696',5,11,16,12; ...
    '3_10',11,11,16,8; ...
    '3_12',9,34,3,1; ...
    '3_13',17,20,14,1; ...
    '1_1',7,12,5,5; ...
    '1_2',6,25,20,8; ...
    '1_10',23,32,8,20; ...
    '1_17',23,40,11,14; ...
    '2_17',7,37,20,3; ...
    '5_3',11,13,12,4; ...     %stressed subjects start here
    '5_5',20,26,10,5; ...
    '898',18,12,15,13; ...
    '892',12,31,20,11; ...
    '4_1',45,34,15,10; ...
    '4_2',26,51,22,5; ...
    '4_3',11,24,16,11; ...
    '4_4',20,22,17,21; ...
    '4_5',14,4,31,17; ...
    '778',13,20,28,36; ...
    '787',25,12,9,4; ...
    '3_1',4,23,2,10; ...
    '3_4',7,27,19,9; ...
    '3_6',28,13,13,9; ...
    '3_7',13,29,15,11; ...
    '3_8',20,22,18,10; ...
    '3_9',26,6,10,9; ...
    '689',14,2,8,35; ...
    '684',13,5,6,16; ...
    '1_3',14,12,26,23; ...
    '1_4',2,1,21,36; ...
    '1_5',9,24,18,13; ...
    '1_7',14,16,14,19; ...
    '1_9',17,0,12,63; ...
    '1_16',13,2,6,40; ...
    '2_16',13,11,16,12; ...
    '3_16',9,16,16,13; ...
    '4_16',4,36,NaN,NaN; ...
    '5_16',14,15,12,15; ...
    '9',9,14,9,7; ...    % controls for behavior + M2 spontaneous activity study
    '10',10,27,10,5; ... 
    '11',8,25,17,12; ...
    '88',3,21,11,7; ...
    '1',9,13,13,25; ...    % stressed for behavior + M2 spontaneous activity study
    '4',9,1,8,28; ...
    '5',4,5,12,12; ...
    '82',12,8,20,22; ...
    '83',7,16,16,6; ...
    '84',11,8,10,15; ...
    '85',7,0,21,27; ...
};

%% calculate the social interaction index for each subject
%copy everything, and then later add the SI index
subj_info = subj_info_raw;

numSubject = numel(subj_info_raw.subjectLabel);
for j=1:numSubject
    %the row where the subject name matches what is in the SI_array look up table
    rowIdx = find(strcmp(SI_array,subj_info_raw.subjectLabel{j}));
    
    if numel(rowIdx) == 1
        %the social interaction index
        subj_info.SIRatio_IZ(j,1) = SI_array{rowIdx,3} / SI_array{rowIdx,2};
        subj_info.SIRatio_Corners(j,1) = SI_array{rowIdx,5} / SI_array{rowIdx,4};
    else
        subj_info.SIRatio_IZ(j,1) = nan;
        subj_info.SIRatio_Corners(j,1) = nan;
    end
end

%% use threshold to split stressed mice into susceptible and resilient groups
for j=1:numel(subj_info.subjCond)
    if subj_info.subjCond(j) == 1  %if stressed subject
        if subj_info.SIRatio_IZ(j) <= threshold
            subj_info.subjClassif(j,1) = 1; %susceptible
        else
            subj_info.subjClassif(j,1) = 2; %resilient
        end
    else
        subj_info.subjClassif(j,1) = 0;   %control subject
    end
end
subj_info.classiflabel = {'Control','Susceptible','Resilient'};

%% plot the distribution of social interaction index for the cohort
figure;

subplot(5,3,[1 2 4 5]); hold on;

% ---- draw it by randomly moving dots
% %draw the line to indicate threshold for susceptible vs resilient
% plot(threshold*[1 1],[-1 1+numel(unique(subj_info.subjClassif))],'k--','LineWidth',3);
% set(gca,'ytick',[0.3 1.3 2.3]);
% set(gca,'yticklabel',subj_info.classiflabel);
% ylim([-0.5 numel(unique(subj_info.subjClassif))]);
% xlim([0 ceil(max(subj_info.SIRatio_IZ))]);
% 
% %plot the SI ratio for each subject
% for j=1:numel(unique(subj_info.subjClassif))  %number of conditions    
%     %plot raw data
%     temp=subj_info.SIRatio_IZ(subj_info.subjClassif==j-1); 
%     if j==1   %controls
%         plot(temp,(j-1)+0.6*rand(size(temp)),'ko','MarkerFaceColor',[0.7 0.7 0.7],'MarkerSize',15);
%     elseif j==2
%         plot(temp,(j-1)+0.6*rand(size(temp)),'ks','MarkerSize',15);
%     else
%         plot(temp,(j-1)+0.6*rand(size(temp)),'ks','MarkerSize',15);
%     end
% end

% ---- draw it with a legit beeswarm plot

%draw the line to indicate threshold for susceptible vs resilient
plot([-1 1+numel(unique(subj_info.subjClassif))],threshold*[1 1],'k--','LineWidth',3);
view(90,90);
set(gca,'xtick',[0 1 2]);
set(gca,'xticklabel',subj_info.classiflabel);
xlim([-0.5 numel(unique(subj_info.subjClassif))]);
ylim([0 ceil(max(subj_info.SIRatio_IZ))]);

x = subj_info.subjClassif(~isnan(subj_info.SIRatio_IZ));
y = subj_info.SIRatio_IZ(~isnan(subj_info.SIRatio_IZ));

beeswarm(x,y,'nosort','none',3);
ylabel('Social interaction ratio');
%ylim([0 9]);

print(gcf,'-dpng','SI_ratios');    %png format
saveas(gcf, 'SI_ratios', 'fig');


end